<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- <link rel="shortcut icon" type="image/png" href="icons8-iceberg-48.png">-->

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">
        

    <title>L-Systems</title>
</head>

<body>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
        <!-- development version, includes helpful console warnings -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    
        <!-- production version, optimized for size and speed -->
        <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script>-->
    <script>
        // Pre Content Script




    </script>

    <body class="text-center">

        <div class='container jumbotron'>
            <h1>L-Systems</h1>
        </div>

        <div class='container' id='lSystemsApp'>
            <div v-html="log"> </div>

            <div class="form-group">
                    <button type="button" class="btn btn-primary" id="kochTemplateButton" v-on:click="setKochTemplate">Koch Snowflake</button>

            </div>

            <div class="form-group">
                <label class="control-label" for="variables">Variables:</label>
                <input type="text" class="form-control" v-model="V" id="variables">
            </div>

            <div class="form-group">
                <label class="control-label" for="alphabet">&Sigma;:</label>
                <input type="text" class="form-control" v-model="E" id="alphabet">
            </div>

            <div class="form-group">
                <label class="control-label" for="axiom">Axiom:</label>
                <input type="text" class="form-control" v-model="A" id="axiom">
            </div>

            <div class="form-group">
                <label class="control-label" for="rules">Rules:</label>
                <textarea  class="form-control" rows="3" v-model="P" id="rules"></textarea>
            </div>

            <div class="form-group">
                <label class="control-label" for="iterations">Iterations:</label>
                <input type="text" class="form-control" v-model="n" id="iterations">
            </div>
            
            <div class="form-group">
                <button type="button" class="btn btn-primary" id="generateButton" v-on:click="generate">Generate</button>
            </div>

            <div class="form-group">
                Output:
                <textarea class="form-control" rows="5" id="output">{{ out }}</textarea>
            </div>

            <canvas id='screen' width='500' height='300'></canvas>
        </div>


        <script>
        // Post Content Scripts
        var Turtle = {
            x : 0,
            y : 0,
            length: 5,
            alpha : 60,
            angleRad : 0,
            ctx: null,
            log : function(){
                console.log("[Turtle] x:" + this.x + " y:" + this.y + " angle:" + this.angleRad);
            },
            forward : function(length = this.length)
            {
                var lastX = this.x;
                var lastY = this.y;

                this.x += length * Math.sin(this.angleRad);
                this.y += length * Math.cos(this.angleRad);

                if(this.ctx)
                {
                    /*
                    if(this.x > canvas.width || this.x < 0)
                        this.ctx.scale(2,1);


                    if(this.y > canvas.height || this.y < 0)
                        this.ctx.scale(1,2);
                    */

                    this.ctx.beginPath();
                    this.ctx.moveTo(lastX,lastY);
                    this.ctx.lineTo(this.x,this.y);
                    this.ctx.stroke();
                }
            },
            right : function(alpha = this.alpha){
                this.angleRad += alpha * Math.PI / 180.0;
            },
            left : function(alpha = this.alpha){
                this.right(-alpha);
            },
            clear : function(){
                this.ctx.clearRect(0, 0, canvas.width, canvas.height);
                this.x = 0;
                this.y = 0;
                this.angleRad = 0;

            }
        }

        var app = new Vue({
            el: '#lSystemsApp',
            data: {
                V: "FG",
                P: "F=F-F",
                E: "-+",
                A: "FG",
                n: 2,
                out : "",
                log : ""
            },
            methods: {

                setKochTemplate : function(){
                    this.V = "F";
                    this.P = "F=F-F++F-F";
                    this.E = "+-";
                    this.A = "F";
                    this.out = "";
                    this.log = "";
                },

                setHilbertTemplate : function (){
                    this.V = "F";
                    this.P = "F=F-F++F-F";
                    this.E = "+-f";
                    this.A = "F";
                    this.out = "";
                    this.log = "";

                },

                generate: function () {
                    var i;
                    var k;
                    var s;
                    var r;
                    var off;
                    var currentRule;
                    var ruleSet;
                    var input = this.A;
                    var output;


                    // Check if values are set 
                    if(this.V.length == 0)
                    {
                        this.log = "<div class='alert alert-danger'>Please add at least one Variable. For example F or FG or XYZ</div>";
                        return;
                    }

                    if(this.P.length == 0)
                    {
                        this.log = "<div class='alert alert-danger '>Please add at least one rule. For example F=F-F or G=F+G</div>";
                        return;
                    }

                    if(this.A.length == 0)
                    {
                        this.log = "<div class='alert alert-danger'>Please add an Axiom (Start value). For example FG</div>";
                        return;
                    }

                    
                    this.log = "";
                    Turtle.clear();

                    // Every iteration is a new generation
                    for (k = 0; k < this.n; k++) {
                        output = "";
                        
                        // Go throgh each single char and try to replace it
                        for ( i = 0; i < input.length; i++ ) {
                            s = input[i];
                            
                            
                            if(this.V.indexOf(s) != -1)
                            {
                                // Find rule for this variable and replace it
                                
                            if(s == 'F')
                                Turtle.forward();

                                ruleSet = this.P.split('\n');

                                for(r=0;r<ruleSet.length;r++)
                                {

                                    currentRule = ruleSet[r];
                                    if(currentRule.length > 2 && currentRule[0] == s)
                                    {
                                        off = currentRule.indexOf('=');

                                        output += currentRule.substr(off+1);
                                    }
                                }

                            }
                            else if(this.E.indexOf(s) != -1)
                            {
                                // Terminalsymbol -> Just append it
                                if(s == '+')
                                    Turtle.left();
                                else if(s == '-')
                                    Turtle.right();
                                else if(s == 'f')
                                    Turtle.forward();

                                output += s;
                            }
                            else
                            {
                                this.log = "<div class='alert alert-danger'>Unknwon symbol '" + s + "' @ Position " + i + "</div>";
                            }
                            
                        }
                            input = output;
                    }

                    //this.A = output;
                    this.out = output;
                }
            }
        });

        var canvas = document.getElementById("screen");

        if(canvas && canvas.getContext)
        {
            Turtle.ctx = canvas.getContext('2d');
        }
        else
        {
            console.log("Canvas error.");
        }


        </script>
        <div class='footer'>(C) 2018 Raphael Pour LGPL</div>
    </body>

</html>