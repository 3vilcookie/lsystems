<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/png" href="icons8-navigate-96.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
    <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <!-- production version, optimized for size and speed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script>-->

    <!-- Include our Turtle Class-->
    <script src="turtle.js"></script>

    <title>L-Systems</title>
</head>

<body class="text-center">
    <div class='jumbotron' style='padding:10px'>
        <h1>
            <img src='icons8-navigate-96.png' style='vertical-align:center;margin-right:40px'>L-Systems</h1>
    </div>

    <div class='container' id='lSystemsApp'>
        <div v-html="log"> </div>

        <div class="form-group">
            <button type="button" class="btn btn-primary" id="kochTemplateButton" v-on:click="setKochTemplate">Koch Curve</button>
            <button type="button" class="btn btn-primary" id="kochSnowflakeTemplateButton" v-on:click="setKochSnowflakeTemplate">Koch Snowflake</button>
            <button type="button" class="btn btn-primary" id="hilbertTemplateButton" v-on:click="setHilbertTemplate">Hilbert Curve</button>
            <button type="button" class="btn btn-primary" id="sierpinskiTriangleTemplateButton" v-on:click="setSierpinskiTriangleTemplate">Sierpinski Triangle</button>
            <button type="button" class="btn btn-primary" id="dragonCurveTemplateButton" v-on:click="setDragonCurveTemplate">Dragon Curve</button>

        </div>

        <!--class='form-inline'-->
        <div id="accordion" style='padding-bottom:25px'>
            <div class="card">
                <div class="card-header">
                    <a class="card-link" data-toggle="collapse" href="#collapse1">L-System Language</a>
                </div>
                <div id="collapse1" class="collapse show">
                    <div class="card-body">
                        <div class="form-group">
                            <label class="control-label" for="variables">Variables (V):</label>
                            <input type="text" class="form-control" v-model="V" id="variables">
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="alphabet">Alphabet (&Sigma;):</label>
                            <input type="text" class="form-control" v-model="E" id="alphabet">
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="axiom">Axiom (&omega;):</label>
                            <input type="text" class="form-control" v-model="A" id="axiom">
                        </div>

                        <div class="form-group">
                            <label class="control-label" for="rules">Rules (P):</label>
                            <textarea class="form-control" rows="3" v-model="P" id="rules"></textarea>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <a class="card-link" data-toggle="collapse" href="#collapse2">Turtle Graphic</a>
                    </div>
                    <div id="collapse2" class="collapse show">
                        <div class="card-body">
                            <div class="form-group">
                                <label class="control-label" for="iterations">Iterations:</label>
                                <input type="number" class="form-control" v-model="n" id="iterations">
                            </div>

                            <div class="form-group">
                                <label class="control-label" for="alpha">Alpha:</label>
                                <input type="number" class="form-control" v-model="alpha" id="alpha">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <a class="card-link" data-toggle="collapse" href="#collapse3">Canvas Debugging</a>
                    </div>
                    <div id="collapse3" class="collapse hidden">
                        <div class="card-body">
                            <div class="form-group">
                                <label class="control-label" for="alphaOffset">Alpha Offset:</label>
                                <input type="number" class="form-control" v-model="alphaOffset" id="alphaOffset">
                            </div>

                            <div class="form-group">
                                <label class="control-label" for="xOffset">X Offset:</label>
                                <input type="number" class="form-control" v-model="xOffset" id="xOffset">
                            </div>


                            <div class="form-group">
                                <label class="control-label" for="yOffset">Y Offset:</label>
                                <input type="number" class="form-control" v-model="yOffset" id="yOffset">
                            </div>

                            <div class="form-group">
                                <label class="control-label" for="length">Length:</label>
                                <input type="number" class="form-control" v-model="length" id="length">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <button type="button" class="btn btn-primary" id="generateButton" v-on:click="generate">Generate</button>
        </div>

        <div class="form-group">
            Output:
            <textarea class="form-control" rows="5" id="output">{{ out }}</textarea>
        </div>

        <canvas style='border: solid black 1px;' id='screen' width='300' height='300'></canvas>
    </div>


    <script>
        // Post Content Scripts

        var app = new Vue({
            el: '#lSystemsApp',
            data: {
                V: "FG",
                P: "F=F-G\nG=G+F",
                E: "-+",
                A: "FG",
                n: 2,
                length: 1,
                alpha: 60.0,
                alphaOffset: 0.0,
                xOffset: 0.0,
                yOffset: 0.0,
                out: "",
                log: "",
                turtle: null,
                ctx: null
            },
            methods: {

                setKochTemplate: function () {
                    this.V = "F";
                    this.P = "F=F-F++F-F";
                    this.E = "+-";
                    this.A = "F";
                    this.alpha = 60.0;
                    this.out = "";
                    this.log = "";
                },
                setKochSnowflakeTemplate: function () {
                    this.V = "F";
                    this.P = "F=F-F++F-F";
                    this.E = "+-";
                    this.A = "F++F++F++F";
                    this.alpha = 60.0;
                    this.out = "";
                    this.log = "";
                },

                setDragonCurveTemplate: function () {
                    this.V = "FG";
                    this.P = "F=F+Gf+\nF=-fF-G";
                    this.E = "+-f";
                    this.A = "fF";
                    this.alpha = 90.0;
                    this.out = "";
                    this.log = "";

                },
                setHilbertTemplate: function () {
                    this.V = "AB";
                    this.P = "A=-Bf+AfA+fB-\nB=+Af-BfB-fA+";
                    this.E = "+-f";
                    this.A = "A";
                    this.alpha = 90.0;
                    this.out = "";
                    this.log = "";

                },
                setSierpinskiTriangleTemplate: function () {
                    this.V = "FG";
                    this.P = "F=G-F-G\nG=F+G+F";
                    this.E = "+-";
                    this.A = "F";
                    this.alpha = 60.0;
                    this.out = "";
                    this.log = "";

                },

                generate: function () {
                    var i;
                    var k;
                    var s;
                    var r;
                    var off;
                    var currentRule;
                    var ruleSet;
                    var input = this.A;
                    var output;


                    // Check if values are set 
                    if (this.V.length == 0) {
                        this.log = "<div class='alert alert-danger'>Please add at least one Variable. For example F or FG or XYZ</div>";
                        return;
                    }

                    if (this.P.length == 0) {
                        this.log = "<div class='alert alert-danger '>Please add at least one rule. For example F=F-F or G=F+G</div>";
                        return;
                    }

                    if (this.A.length == 0) {
                        this.log = "<div class='alert alert-danger'>Please add an Axiom (Start value). For example FG</div>";
                        return;
                    }


                    this.log = "";
                    //Turtle.clear();
                    this.turtle = new Turtle(this.ctx, this.alpha, 1 / this.n);
                    this.turtle.clear();

                    // Every iteration is a new generation
                    for (k = 0; k < this.n; k++) {
                        output = "";

                        // Go throgh each single char and try to replace it
                        for (i = 0; i < input.length; i++) {
                            s = input[i];


                            if (this.V.indexOf(s) != -1) {
                                // Find rule for this variable and replace it

                                ruleSet = this.P.split('\n');

                                for (r = 0; r < ruleSet.length; r++) {
                                    currentRule = ruleSet[r];
                                    if (currentRule.length > 2 && currentRule[0] == s) {
                                        off = currentRule.indexOf('=');
                                        output += currentRule.substr(off + 1);
                                    }
                                }

                            }
                            else if (this.E.indexOf(s) != -1)
                                output += s;
                            else
                                this.log = "<div class='alert alert-danger'>Unknwon symbol '" + s + "' @ Position " + i + "</div>";

                        }
                        input = output;
                    }

                    this.out = output;

                    // Draw it.
                    //Turtle.angleRad = 20 * Math.PI / 360.0; 
                    //Turtle.alpha = this.alpha;
                    //Turtle.angleOffset = this.angleOffset;
                    this.turtle.xOffset = this.xOffset;
                    this.turtle.yOffset = this.yOffset;
                    this.turtle.alphaOffset = this.alphaOffset;
                    //Turtle.length = 20.0/this.n;
                    //Turtle.length = (this.n/3)*20;
                    //Turtle.length = 10;

                    this.turtle.computeWord(output);
                }
            }
        });

        var canvas = document.getElementById("screen");

        if (canvas && canvas.getContext) {
            app.ctx = canvas.getContext('2d');
        }
        else {
            console.log("Canvas error.");
        }


    </script>
    <div class='footer'>
        &copy; 2018 Raphael Pour LGPL | Icon by <a href='https://icons8.com'>Icons8</a>
    </div>
</body>
</html>