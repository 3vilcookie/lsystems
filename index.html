<!doctype html>
<html lang="en">

<!--
    @file:      index.html
    @brief:     L-System Frontend
    @author:    Raphael Pour <turtle@raphaelpour.de>
    @license:   (C) 2018 Raphael Pour LGPL
-->

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" type="image/png" href="logo.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4"
        crossorigin="anonymous">

    <!-- Custom CSS to make  UI more awesome-->
    <link rel="stylesheet" href="style.css">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>-->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
    <!-- development version, includes helpful console warnings -->
    <!--<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>-->
    <!--<script src="https://unpkg.com/vue@2.3.3/dist/vue.js"></script>-->
    <script src="https://unpkg.com/vue"></script>

    <!-- production version, optimized for size and speed -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script>-->


    <!-- Include our Box Dimension class for calculating and visualizing the Box Dimension -->
    <script src="boxdim.js"></script>

    <!-- Include our Bounds Class to calculate Extrema and Center of a set of points-->
    <script src="bounds.js"></script>

    <!-- Include our Turtle Class to draw command-based on a Cavas-->
    <script src="turtle.js"></script>

    <!-- Include our Silent Turtle Class to create a set of points without drawing it on a canvas-->
    <script src="silent_turtle.js"></script>

    <!-- Include our LSystem Class which builds up a formal language and generates words-->
    <script src="lsystem.js"></script>

    <!-- Include Audio Interpreter to hear the Fractal-->
    <script src="audiopreter.js"></script>

    <title>L-Systems</title>
</head>

<body class="text-center">
    <div class='jumbotron' style='padding:0px'>
        <h1 style='padding:5px'>
            <a href='index.html'><img src='logo.png' style='vertical-align:center;margin-right:40px'></a>L-Systems</h1>
        <p style='padding:5px'><em>~Fractals, powered by formal languages~</em></p>
    </div>
    <div class='container' id='lSystemsApp'>
        <div class='row'>
            <div class="col-md-2" style='text-align:left;line-height:40px;'>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="kochTemplateButton" v-on:click="setKochTemplate">Koch
                        Curve</button>
                    <button type="button" class="btn btn-primary" id="kochSnowflakeTemplateButton" v-on:click="setKochSnowflakeTemplate">Koch
                        Snowflake</button>
                    <button type="button" class="btn btn-primary" id="hilbertTemplateButton" v-on:click="setHilbertTemplate">Hilbert
                        Curve</button>
                    <button type="button" class="btn btn-primary" id="sierpinskiTriangleTemplateButton" v-on:click="setSierpinskiTriangleTemplate">Sierpinski
                        Triangle</button>
                    <button type="button" class="btn btn-primary" id="dragonCurveTemplateButton" v-on:click="setDragonCurveTemplate">Dragon
                        Curve</button>
                    <button type="button" class="btn btn-primary" id="plantTemplateButton" v-on:click="setPlantTemplate">Plant</button>
                    <button type="button" class="btn btn-primary" id="lstarTemplateButton" v-on:click="setLStarTemplate">LStar</button>
                    <button type="button" class="btn btn-primary" id="lecyCTemaplateButton" v-on:click="setLecyCTemplate">Lecy-C-Curve</button>
                    <button type="button" class="btn btn-primary" id="gosperTemplateButton" v-on:click="setGosperTemplate">Gosper-Curve</button>
                    <button type="button" class="btn btn-success" id="coastlineTemplateButton" v-on:click="setCoastlineTemplate">Coastline</button>
                    <button type="button" class="btn btn-success" id="cloudTemplateButton" v-on:click="setCloudTemplate">Cloud</button>
                    <button type="button" class="btn btn-success" id="LichterketteTemplateButton" v-on:click="setLichterketteTemplate">Lichterkette</button>
                </div>
            </div>
            <div class='col-md-6'>
                <div id="accordion" style='padding-bottom:25px;'>
                    <div class="card" id="card1">
                        <div class="card-header cardSize">
                            <a class="card-link" data-toggle="collapse" href="#collapse1">L-System Language</a>
                        </div>
                        <div id="collapse1" class="collapse show" data-parent="#accordion">
                            <div class="card-body">
                                <div class="form-group row form-medium">
                                    <label class="control-label col-sm-4" for="variables">Variables (V)</label>
                                    <input type="text" class="form-control col-sm-7 textField" v-model="V" v-on:keyup="autoGenerate"
                                        id="variables">
                                </div>
                                <div class="form-group row form-medium">
                                    <label class="control-label col-sm-4" for="alphabet">Alphabet (&Sigma;)</label>
                                    <input readonly type="text" class="form-control col-sm-7 textField" v-model="E"
                                        v-on:keyup="autoGenerate" id="alphabet">
                                </div>
                                <div class="form-group row form-medium">
                                    <label class="control-label col-sm-4" for="axiom">Axiom (&omega;)</label>
                                    <input type="text" class="form-control col-sm-7 textField" v-model="A" v-on:keyup="autoGenerate"
                                        id="axiom">
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="rules">Rules (P)</label>
                                    <textarea class="form-control col-sm-7" rows="3" v-model="P" v-on:keyup="autoGenerate"
                                        id="rules"></textarea>
                                </div>
                                <div class="form-group">
                                    <button type="button" class="btn btn-danger" id="clearButton" v-on:click="clear">Clear</button>
                                    <button class="btn btn-primary collapsed card-link" data-toggle="collapse" href="#collapseLanguageOut">Language
                                        Output</button>
                                </div>

                                <div id="collapseLanguageOut" class="collapse hidden">
                                    <div class="card-body">
                                        <div class="form-group">
                                            Output:
                                            <textarea readonly class="form-control" rows="5" id="output">{{ out }}</textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" id="card2">
                        <div class="card-header cardSize">
                            <a class="collapsed card-link" data-toggle="collapse" href="#collapse2">Turtle
                                Graphic Settings</a>
                        </div>
                        <div id="collapse2" class="collapse hidden" data-parent="#accordion">
                            <div class="card-body">
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="iterations">Iterations</label>
                                    <input type="range" value="1" step="1" min="1" max="20" class="form-control col-sm-4 slider"
                                        v-model="n" v-on:change="autoGenerate" id="iterations">
                                    <div class="col-sm-2 form-value">{{ n }}</div>
                                </div>
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="alpha">Alpha (&alpha;)</label>
                                    <input type="range" start="0" min="0" max="360" step="1" class="form-control col-sm-4 slider"
                                        v-model="alpha" v-on:change="autoGenerate" id="alpha">
                                    <div class="col-sm-2 form-value">{{alpha}}°</div>
                                </div>
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="startAngleId">Start-Angle (&beta;)</label>
                                    <input type="range" start="0" min="0" max="360" step="1" class="form-control col-sm-4 slider"
                                        v-model="startAngle" v-on:change="autoGenerate" id="startAngleId">
                                    <div class="col-sm-2 form-value">{{startAngle}}°</div>
                                </div>
                                <div class="form-group row form-small ">
                                    <label class="control-label col-sm-4 " for="autoGenId">Auto Generate</label>
                                    <input type="checkbox" class="form-control col-sm-4" v-model="autoGen" id="autoGenId">
                                </div>
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="showPointsId">Show Points</label>
                                    <input type="checkbox" class="form-control col-sm-4" v-model="showPoints" v-on:change="autoGenerate"
                                        id="showPointsId form-value">
                                </div>
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="gridSizeId">Grid Size</label>
                                    <input type="range" class="form-control col-sm-4 slider" min="1" max="200" step="1"
                                        v-model="gridSize" v-on:change="autoGenerate" id="gridSizeId">
                                    <div class="col-sm-2 form-value">{{ gridSize }}</div>
                                </div>
                                <div class="form-group row form-small">
                                    <label class="control-label col-sm-4 " for="showGridId">Show Grid</label>
                                    <input class="col-sm-4" type="checkbox" v-model="gridCheckBox" v-on:change="autoGenerate"
                                        id="showGridId">
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="card" id="card3">
                        <div class="card-header cardSize">
                            <a class="collapsed card-link" data-toggle="collapse" href="#collapse3">
                                Command Reference</a>
                        </div>
                        <div id="collapse3" class="collapse hidden" data-parent="#accordion">
                            <div class="card-body">
                                <table class="table table-sm" style='text-align:left'>
                                    <thead>
                                        <tr>
                                            <th>Symbol</th>
                                            <th>Turtle</th>
                                            <th>Audio Interpreter</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style='font-family:monospace;'>f,F</td>
                                            <td>Go forward and draw a line</td>
                                            <td>Play short note</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>G</td>
                                            <td>Go forward and draw a line</td>
                                            <td>Play long note</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>+</td>
                                            <td>Turn right by &alpha;&deg;</td>
                                            <td>Increment Note by one semitone</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>-</td>
                                            <td>Turn left by &alpha;&deg;</td>
                                            <td>Decrement Note by one semitone</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>|</td>
                                            <td>Turn around (+180&deg;)</td>
                                            <td>-</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>[</td>
                                            <td>Save current state (Position and Orientation)</td>
                                            <td>Save current state (Note)</td>
                                        </tr>
                                        <tr>
                                            <td style='font-family:monospace;'>]</td>
                                            <td>Restore latest state</td>
                                            <td>Restore latest state</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="card6">
                        <div class="card-header cardSize">
                            <a class="collapsed card-link" data-toggle="collapse" href="#collapse6">Fractal
                                Properties</a>
                        </div>
                        <div id="collapse6" class="collapse hidden" data-parent="#accordion">
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="calculateSelfDimId">
                                        Self-Similarty Dimension:</label>
                                    <input type="checkbox" class="form-control col-sm-4" disabled = "disabled" v-on:change="autoGenerate"
                                        v-model="selfSimDimCheckBox" id="calculateSelfDimId">
                                </div>

                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="calculateBoxDimId">
                                        Box Dimension:</label>
                                    <input type="checkbox" class="form-control col-sm-4" v-model="boxDimCheckBox"
                                        v-on:change="autoGenerate" id="calculateBoxDimId">
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4 " for="gridSizeId">Grid Size</label>
                                    <input type="range" class="form-control col-sm-4 slider" min="1" max="200" step="1"
                                        v-model="gridSize" v-on:change="autoGenerate" id="gridSizeId">
                                    <div class="col-sm-2 form-value">{{ gridSize }}</div>
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4 " for="iterations">Iterations</label>
                                    <input type="range" value="1" step="1" min="1" max="20" class="form-control col-sm-4 slider"
                                        v-model="n" v-on:change="autoGenerate" id="iterations">
                                    <div class="col-sm-2 form-value">{{ n }}</div>
                                </div>
                                <table class="table table-sm" style='text-align:left'>
                                    <thead>
                                        <tr>
                                            <th>Property</th>
                                            <th>Value</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="color:#AAA;">
                                            <td>Self-Similarity Dimension</td>
                                            <td>{{ selfSimilarityDim }}</td>
                                        </tr>
                                        <tr style="color:#AAA;">
                                            <td>Copies</td>
                                            <td>{{ selfSimilarityCopies }}</td>
                                        </tr>
                                        <tr style="color:#AAA;">
                                            <td>Scale Factor</td>
                                            <td>{{ selfSimilarityScaleFactor }}</td>
                                        </tr>
                                        <tr>
                                            <td>Box Dimension</td>
                                            <td>{{ boxDimensionValue }}</td>
                                        </tr>
                                        <tr>
                                            <td>Occupied boxes</td>
                                            <td>{{ occupiedBoxes }} / {{ allBoxes }}</td>
                                        </tr>
                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card" id="card22">
                        <div class="card-header cardSize">
                            <a class="collapsed card-link" data-toggle="collapse" href="#collapse22">Audio Interpreter
                                <span class="glyphicon-glyphicon-fire"></span></a>
                        </div>
                        <div id="collapse22" class="collapse hidden" data-parent="#accordion">
                            <div class="card-body">
                                <div class="form-group">
                                    <button class="btn btn-success" type="button" id="playFractalButton" v-on:click="playFractal">Play
                                    </button>
                                    <button class="btn btn-danger" type="button" id="stopFractalButton" v-on:click="stopFractal">Stop
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="display:none" id="card4">
                        <div class="card-header cardSize">
                            <a class="collapsed card-link" data-toggle="collapse" href="#collapse4">Debugging</a>
                        </div>
                        <div id="collapse4" class="collapse hidden" data-parent="#accordion">
                            <div class="card-body">
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="xoffsetId">X-Offset:</label>
                                    <input readonly type="range" min="-500" max="500" value="0" step="1" class="form-control col-sm-4 slider"
                                        v-model="xoffsetUI" v-on:change="generate" id="xoffsetId">
                                    <div class="col-sm-2">{{ xoffsetUI}}</div>
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="yoffsetId">Y-Offset:</label>
                                    <input readonly type="range" min="-500" max="500" value="0" step="1" class="form-control col-sm-4 slider"
                                        v-model="yoffsetUI" v-on:change="generate" id="yoffsetId">
                                    <div class="col-sm-2">{{ yoffsetUI}}</div>
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="zoomId">Zoom:</label>
                                    <input readonly type="range" min="0.1" max="10" value="1" step="0.11" class="form-control col-sm-4 slider"
                                        v-model="zoomUI" v-on:change="generate" id="zoomId">
                                    <div class="col-sm-2">{{ zoomUI}}</div>
                                </div>
                                <div class="form-group row">
                                    <label class="control-label col-sm-4" for="showCanvasDebugId">Show Canvas Debug
                                        Graphics</label>
                                    <input type="checkbox" class="form-control col-sm-1" v-model="showCanvasDebug"
                                        v-on:change="autoGenerate" id="showCanvasDebugId">
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div v-html="log"> </div>
                <div class="form-group">
                    <button type="button" class="btn btn-primary" id="generateButton" v-on:click="generate">Generate</button>
                    <p style="color:grey"><em>{{ durationOut }}</em></p>
                </div>
            </div>
            <div class='col-md-4'>
                <canvas id='screen' class="screensize" style='border:2px solid black' width='800' height='800'></canvas>
            </div>
        </div>
    </div>
    <script>
        "use strict";

        if (window.location.search != 0 && window.location.search == "?debug")
            $("#card4").show();


        var app = new Vue({
            el: '#lSystemsApp',
            data: {
                V: "",
                P: "",
                E: "+-[]|f",
                A: "",
                n: 4,
                alpha: 45.0,
                startAngle: 0.0,
                angleOffset: 90.0,
                out: "",
                log: "",
                xoffsetUI: 0,
                yoffsetUI: 0,
                zoomUI: 1,
                startTime: null,
                endTime: null,
                durationOut: "",
                showCanvasDebug: false,
                ctx: null,
                autoGen: true,
                selfSimilarityDim: 0,
                selfSimilarityCopies: 0,
                selfSimilarityScaleFactor: 0,
                boxDimensionValue: 0,
                occupiedBoxes : 0,
                allBoxes : 0,
                gridSize: 50,
                gridCheckBox: false,
                audiopreter: null,
                boxDimCheckBox: false,
                selfSimDimCheckBox: false,
                showPoints: false
            },
            created: function () {
                //this.setLStarTemplate(); // --> Default

                // Disable AutoGenerate inside the constructor
                // to avoid Canvas Context Reference Errors
                // This is maybe caused by the execution order of the browser
                var temp = this.autoGen;
                this.autoGen = false;
                this.setKochSnowflakeTemplate();
                this.autoGen = temp;
            },
            methods: {

                autoGenerate: function () {
                    if (this.autoGen)
                        this.generate();
                },
                generate: function () {
                    this.startTime = performance.now();

                    this.clearCanvas();

                    var l = new LSystem();
                    var output = "";
                    this.log = "";
                    try {
                        l.V = this.V;
                        l.E = this.E;
                        l.Axiom = this.A;
                        l.P = this.P;
                        l.n = this.n;
                        l.generate()
                        this.out = l.out;
                    } catch (error) {
                        this.log = "<div class='alert alert-danger'>[LSystem]: " + error + "</div>";
                        return;
                    }

                    if (this.selfSimDimCheckBox)
                        this.calcDimension();

                    if (this.boxDimCheckBox)
                        this.calcBoxDimension(l);
                    else {
                        var t = new Turtle(this.ctx.canvas.width, this.ctx.canvas.height, parseFloat(this.alpha), Number(this.n), 100.0, this.showCanvasDebug, this.showPoints);

                        t.angleOffset = parseFloat(this.angleOffset) + parseFloat(this.startAngle);

                        //t.xOffsetUI = Number(this.xoffsetUI);
                        //t.yOffsetUI = Number(this.yoffsetUI);
                        //t.zoomUI = Number(this.zoomUI);
                        //t.clear();

                        t.computeWord(l.out);
                        this.ctx.drawImage(t.finalCanvas, 0, 0);
                    }

                    if (this.gridCheckBox)
                        this.drawGrid();

                    this.endTime = performance.now();

                    var duration = (this.endTime - this.startTime) / 1000.0;
                    this.durationOut = "Rendered within " + duration + "s"


                },

                drawGrid: function () {

                    var localGridSize = Math.max(8, Number(this.gridSize));

                    this.ctx.save();
                    for (let i = 0; i < this.ctx.canvas.width; i += localGridSize) {

                        this.ctx.beginPath();

                        // Horizontal Lines
                        if (Number(i % (localGridSize * 4)) == 0)
                            this.ctx.lineWidth = 1.0;
                        else
                            this.ctx.lineWidth = 0.1;

                        this.ctx.moveTo(0, i);
                        this.ctx.lineTo(this.ctx.canvas.width, i);

                        // Vertical Lines
                        if (i % (localGridSize * 2) == 0)
                            this.ctx.lineWidth = 0.5;
                        else
                            this.ctx.lineWidth = 0.1;
                        this.ctx.moveTo(i, 0);
                        this.ctx.lineTo(i, this.ctx.canvas.height);

                        this.ctx.stroke();
                        this.ctx.closePath();
                        //this.boxContext.strokeRect(x, y, this.gridSize, this.gridSize);

                    }

                    this.ctx.restore();

                },
                calcDimension: function () {
                    var l1 = new LSystem();
                    l1.V = this.V;
                    l1.E = this.E;
                    l1.Axiom = this.A;
                    l1.P = this.P;
                    l1.n = 2;
                    l1.generate();

                    var l2 = new LSystem();
                    l2.V = this.V;
                    l2.E = this.E;
                    l2.Axiom = this.A;
                    l2.P = this.P;
                    l2.n = 3;
                    l2.generate();

                    var t1 = new SilentTurtle();
                    t1.processWord(l1.out, parseFloat(this.alpha));

                    var t2 = new SilentTurtle();
                    t2.processWord(l2.out, parseFloat(this.alpha));

                    var N1 = t1.points.length
                    var N2 = t2.points.length

                    var centerA = Math.sqrt(Math.pow(t1.bounds.xCenter, 2) + Math.pow(t1.bounds.yCenter, 2));
                    var centerB = Math.sqrt(Math.pow(t2.bounds.xCenter, 2) + Math.pow(t2.bounds.yCenter, 2));

                    var scaleFactor = centerB / centerA;
                    var N = N2 / N1;

                    var dim = Math.round(Math.log(N) / Math.log(scaleFactor) * 100) / 100;

                    this.selfSimilarityCopies = N;
                    this.selfSimilarityScaleFactor = scaleFactor;
                    this.selfSimilarityDim = dim;

                },
                calcBoxDimension: function (lsystem = false) {


                    this.clearCanvas();

                    if (lsystem === false) {
                        lsystem = new LSystem();
                        lsystem.V = this.V;
                        lsystem.E = this.E;
                        lsystem.Axiom = this.A;
                        lsystem.P = this.P;
                        lsystem.n = this.n;
                        lsystem.generate();
                    }


                    var width = this.ctx.canvas.width;
                    var height = this.ctx.canvas.height;
                    var resolution = width * height;

                    var t = new Turtle(this.ctx.canvas.width, this.ctx.canvas.height, parseFloat(this.alpha), Number(this.n), 100.0);
                    t.angleOffset = parseFloat(this.angleOffset) + parseFloat(this.startAngle);
                    t.computeWord(lsystem.out);

                    this.out = lsystem.out;


                    //this.ctx.drawImage(t.finalContext.canvas, 0,0);
                    var boxDim = new BoxDimension(t.finalContext, this.gridSize, this.gridCheckBox);
                    boxDim.calculate();
                    this.ctx.drawImage(boxDim.boxCanvas, 0, 0);
                    this.ctx.drawImage(t.finalContext.canvas, 0, 0);

                    /*
                    var img = t.finalContext.getImageData(0, 0, width, height);
                    var pixelCounter = 0;
                    for (let i = 0; i < resolution * 4; i += 4) {
                        if (img.data[i] != 0)
                            pixelCounter++;
                    }
                    */
                   this.occupiedBoxes = boxDim.occupied;
                   this.allBoxes = boxDim.totalBoxCount;
                   this.boxDimensionValue = boxDim.dimension;
                },
                // Clear-Function for L-System and Turtle

                clear: function () {
                    this.V = "";
                    this.P = "";
                    this.E = "+-[]|f";
                    this.A = "";
                },
                clearCanvas: function () {
                    this.ctx.save();
                    this.ctx.setTransform(1, 0, 0, 1, 0, 0);
                    this.ctx.fillStyle = "#FFF"
                    this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);
                    this.ctx.restore();
                },

                // L-System Templates
                setCoastlineTemplate: function () {
                    this.V = "F";
                    this.P = "F=F+F--[--F]+F";
                    this.A = "F|F";
                    this.alpha = 90
                    this.n = 6;
                    this.startAngle = 0;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setCloudTemplate: function () {
                    this.V = "F";
                    this.P = "F=F+FF-";
                    this.A = "F|F";
                    this.alpha = 90
                    this.n = 6;
                    this.startAngle = 0;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setLichterketteTemplate: function () {
                    this.V = "FG";
                    this.P = "F=F+F-G-F-\nG=GFG";
                    this.A = "F|F";
                    this.alpha = 212
                    this.n = 6;
                    this.startAngle = 0.0;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setLStarTemplate: function () {
                    this.V = "AF";
                    this.P = "A=AAffff--f--fff++ff--f--fff+AA-";
                    this.A = "FA";
                    this.alpha = 45.0;
                    this.startAngle = 0.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setKochTemplate: function () {
                    this.V = "F";
                    this.P = "F=F+F--F+F";
                    this.A = "F";
                    this.alpha = 60.0;
                    this.startAngle = 0.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setKochSnowflakeTemplate: function () {
                    this.V = "F";
                    this.P = "F=F+F--F+F";
                    this.A = "F--F--F";
                    this.alpha = 60.0;
                    this.startAngle = 0.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setDragonCurveTemplate: function () {
                    this.V = "FG";
                    this.P = "F=F+Gf+\nG=-fF-G";
                    this.A = "fF";
                    this.alpha = 90.0;
                    this.startAngle = 0.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setHilbertTemplate: function () {
                    this.V = "AB";
                    this.P = "A=-Bf+AfA+fB-\nB=+Af-BfB-fA+";
                    this.A = "B";
                    this.alpha = 90.0;
                    this.startAngle = 0.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setSierpinskiTriangleTemplate: function () {
                    this.V = "FG";
                    this.P = "F=G-F-G\nG=F+G+F";
                    this.A = "F";
                    this.alpha = 60.0;
                    this.startAngle = 0.0;
                    this.n = 4;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setPlantTemplate: function () {
                    this.V = "FG";
                    this.P = "G=F+[[G]-G]-F[-FG]+F\nF=FF";
                    this.A = "G";
                    this.alpha = 25.0;
                    this.startAngle = 270.0;
                    this.n = 3;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setLecyCTemplate: function () {
                    this.V = "F";
                    this.P = "F=+F--F+";
                    this.A = "F";
                    this.alpha = 45.0;
                    this.startAngle = 180.0;
                    this.n = 10;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },
                setGosperTemplate: function () {
                    this.V = "FG";
                    this.P = "F = F+G++G-F--FF-G+\nG = -F+GG++G+F--F-G";
                    this.A = "F";
                    this.alpha = 60.0;
                    this.startAngle = 0.0;
                    this.n = 5;
                    this.out = "";
                    this.log = "";
                    this.autoGenerate();
                },

                // Audio Interpreter
                playFractal: function () {
                    this.stopFractal();
                    var l = new LSystem();
                    var output = "";
                    this.log = "";
                    try {
                        l.V = this.V;
                        l.E = this.E;
                        l.Axiom = this.A;
                        l.P = this.P;
                        l.n = this.n;
                        l.generate()
                        this.out = l.out;
                    } catch (error) {
                        this.log = "<div class='alert alert-danger'>[LSystem]: " + error + "</div>";
                        return;
                    }

                    this.audiopreter = new Audiopreter();
                    this.audiopreter.interpretWord(l.out);
                },

                stopFractal: function () {
                    if (this.audiopreter != null) {
                        this.audiopreter.stop();

                    }
                }
            }
        });


        // Initializes the Canvas and generates the first fractal
        var canvas = document.getElementById("screen");

        if (canvas && canvas.getContext) {
            app.ctx = canvas.getContext('2d');
            app.generate();
        }
        else
            console.log("Canvas error.");
    </script>
    <div class='footer'>
        &copy; 2018 <a href='https://raphaelpour.de'>Raphael Pour</a> | <a href='https://bitbucket.org/evilc00kie/l-systems'>Source
            Code</a> licensed under
        <a href='http://www.gnu.de/documents/gpl.de.html'>GPL</a> | <a href='https://raphaelpour.de/impressum/'>Impressum</a>
    </div>
</body>

</html>